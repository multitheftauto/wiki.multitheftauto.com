---
import { getFunctionInfo } from '@src/utils/functions';
import { getEventTypePretty } from '@src/utils/events';
import { Icon } from '@astrojs/starlight/components';

interface Props {
  itemsByCategory: any;
  what: string;
}

const { itemsByCategory, what } = Astro.props;
const slugify = (str: string) => str.replace(/\s+/g, '-');

const categoryEmojis: Record<string, string> = {
  Account: "ğŸ‘¤",
  Admin: "ğŸ›¡ï¸",
  ACL: "ğŸ”",
  Announcement: "ğŸ“¢",
  Audio: "ğŸ§",
  Sound: "ğŸ”Š",
  Blip: "ğŸ“",
  Browser: "ğŸŒ",
  Building: "ğŸ¢",
  Camera: "ğŸ“·",
  "Clothes and body": "ğŸ§",
  Ped: "ğŸš¶",
  Colshape: "ğŸ”²",
  Cursor: "ğŸ–±ï¸",
  Database: "ğŸ—„ï¸",
  Discord: "ğŸ’¬",
  Drawing: "ğŸ¨",
  Effects: "âœ¨",
  Event: "ğŸ‰",
  Explosion: "ğŸ’¥",
  File: "ğŸ“„",
  Fire: "ğŸ”¥",
  Engine: "âš™ï¸",
  Element: "ğŸ§©",
  HTTP: "ğŸ”—",
  Light: "ğŸ’¡",
  Input: "âŒ¨ï¸",
  Map: "ğŸ—ºï¸",
  GUI: "ğŸ–¥ï¸",
  Module: "ğŸ“¦",
  Marker: "ğŸ“Œ",
  Matrix: "ğŸ§®",
  Object: "ğŸ“¦",
  Output: "ğŸ“¤",
  Path: "ğŸ›£ï¸",
  Pickup: "ğŸ",
  Projectile: "ğŸ¯",
  Player: "ğŸ§‘â€ğŸ’»",
  "Radar area": "ğŸ“¡",
  Resource: "ğŸªµ",
  Server: "ğŸ–§",
  Searchlight: "ğŸ”¦",
  "Settings registry": "âš™ï¸",
  SVG: "ğŸ–¼ï¸",
  Team: "ğŸ‘¥",
  "UTF8 Library": "ğŸ”¤",
  Text: "ğŸ“",
  Utility: "ğŸ› ï¸",
  Water: "ğŸ’§",
  Weapon: "ğŸ”«",
  "Weapon creation": "ğŸ› ï¸",
  XML: "ğŸ“ƒ",
  Vehicle: "ğŸš—",
  World: "ğŸŒ"
};

function displayTitle(title: string) {
    switch (what) {
        case 'all_functions':
        case 'client_functions':
        case 'server_functions':
        case 'shared_functions':
            title = title + ' functions';
            break;
        case 'all_events':
        case 'client_events':
        case 'server_events':
            title = title + ' events';
            break;
    }
    return title;
}
function displayItem(item: any) {
    switch (what) {
        case 'all_functions':
            const funcInfo = getFunctionInfo(item.data);
            return `<a href=/reference/${item.id}>${item.id}</a>
                    (<span class=${"side-"+funcInfo.type}>${funcInfo.typePretty}</span>)`;
        case 'all_events':
            return `<a href=/reference/${item.id}>${item.id}</a>
                    (<span class=${"side-"+item.data.type}>${getEventTypePretty(item.data.type)}-side</span>)`;
        case 'client_functions':
        case 'server_functions':
        case 'shared_functions':
        case 'client_events':
        case 'server_events':
            return `<a href=/reference/${item.id}>${item.id}</a>`;
    }
    return '?';
}
function displayCategory(category: string) {
  category = category.replace(/_/g, ' ');

  // Add emoji if available
  if (categoryEmojis[category]) {
    return `${categoryEmojis[category]} ${category}`;
  }
  return category;
}
---

<section data-pagefind-ignore>
  <h5>Table of Contents</h5>
  <div class="mtatoc-list">
    {Object.keys(itemsByCategory).sort((a, b) => a.localeCompare(b))
      .map(category => (
      <div class="mtatoc-item">
        <a href={`#${slugify(category)}`}>{displayCategory(category)}</a>
      </div>
    ))}
  </div>


  {Object.entries(itemsByCategory)
    .sort(([a], [b]) => a.localeCompare(b))
    .map(([category, items]) => (
    <section id={slugify(category)}>
      <h4>{displayTitle(category)}
        <a href={`#${slugify(category)}`}><Icon size="1.5rem" name="external" class="mtainfoicon"/></a>
      </h4>
      <ul>
        {items
          .slice()
          .sort((a, b) => a.id.localeCompare(b.id))
          .map(item => (
          <li set:html={displayItem(item)}></li>
        ))}
      </ul>
    </section>
  ))}
</section>

<style>
    .mtainfoicon {
        display: inline-block;
        vertical-align: center;
        cursor: pointer;
    }

    .mtatoc-list {
      font-size: 1.1rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .mtatoc-item {
      margin: 0;
      background-color: var(--sl-color-accent-low);
      border-radius: 0.5rem;
    }

    .mtatoc-item a {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      text-decoration: none;
      white-space: nowrap;
      color: var(--sl-color-white);
    }

</style>