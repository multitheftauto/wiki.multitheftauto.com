---
import { Code } from '@astrojs/starlight/components';
import { marked } from 'marked';

interface Props {
  content: string;
}

const { content } = Astro.props;


// We can't do this as we're now organizing pages in folders

// function convertMediaWikiLinks(text: string): string {
//   return text.replace(
//     /\[\[([^|\]#]+)(?:#([^\]]+))?(?:\|([^\]]+))?\]\]/g,
//     (_, link, hash, text) => {
//       const url = `/${link}${hash ? `#${hash}` : ''}`;
//       return `[${text || link}](${url})`;
//     }
//   );
// }

// const processedContent = convertMediaWikiLinks(content);
// const tokens = marked.lexer(processedContent);

const tokens = marked.lexer(content);
---

{
  tokens.map((token) => {
    if (token.type === 'code') {
      return <Code code={token.text} lang={token.lang || 'text'} />;
    }
    return <Fragment set:html={marked.parser([token])} />;
  })
}